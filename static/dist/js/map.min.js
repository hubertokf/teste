/*
 pogomap 2017-08-04 
*/

"use strict";function excludePokemon(e){$selectExclude.val($selectExclude.val().concat(e)).trigger("change")}function notifyAboutPokemon(e){$selectPokemonNotify.val($selectPokemonNotify.val().concat(e)).trigger("change")}function removePokemonMarker(e){mapData.pokemons[e].marker.rangeCircle&&(mapData.pokemons[e].marker.rangeCircle.setMap(null),delete mapData.pokemons[e].marker.rangeCircle),mapData.pokemons[e].marker.setMap(null),mapData.pokemons[e].hidden=!0}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:Number(getParameterByName("lat"))||centerLat,lng:Number(getParameterByName("lon"))||centerLng},zoom:Number(getParameterByName("zoom"))||Store.get("zoomLevel"),fullscreenControl:!0,streetViewControl:!1,mapTypeControl:!1,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl","style_pgo_day","style_pgo_night","style_pgo_dynamic"]}});var e=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",e);var n=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",n);var t=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",t);var a=new google.maps.StyledMapType(pGoStyle,{name:"RocketMap"});map.mapTypes.set("style_pgo",a);var o=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",o);var i=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",i);var s=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"RocketMap (No Labels)"});map.mapTypes.set("style_pgo_nl",s);var r=new google.maps.StyledMapType(pGoStyleDay,{name:"RocketMap Day"});map.mapTypes.set("style_pgo_day",r);var l=new google.maps.StyledMapType(pGoStyleNight,{name:"RocketMap Night"});map.mapTypes.set("style_pgo_night",l);var c=(new Date).getHours(),p=c>=6&&c<19?r:l;map.mapTypes.set("style_pgo_dynamic",p),map.addListener("maptypeid_changed",function(e){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),map.addListener("idle",updateMap),map.addListener("zoom_changed",function(){!0===storeZoom?Store.set("zoomLevel",this.getZoom()):storeZoom=!0,redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),searchMarker=createSearchMarker(),locationMarker=createLocationMarker(),createMyLocationButton(),initSidebar(),$("#scan-here").on("click",function(){var e=map.getCenter();changeLocation(e.lat(),e.lng()),$("#search-switch").checked||($("#search-switch").prop("checked",!0),searchControl("on"))})}function updateLocationMarker(e){if(e in searchMarkerStyles){var n=searchMarkerStyles[e].icon;n?locationMarker.setIcon({url:n,scaledSize:new google.maps.Size(24,24)}):locationMarker.setIcon(n),Store.set("locationMarkerStyle",e)}return locationMarker}function createLocationMarker(){var e=Store.get("followMyLocationPosition"),n="lat"in e?e.lat:centerLat,t="lng"in e?e.lng:centerLng,a=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:{lat:n,lng:t},draggable:!0,icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+2});return a.infoWindow=new google.maps.InfoWindow({content:"<div><b>My Location</b></div>",disableAutoPan:!0}),addListeners(a),google.maps.event.addListener(a,"dragend",function(){var e=a.getPosition();Store.set("followMyLocationPosition",{lat:e.lat(),lng:e.lng()})}),a}function updateSearchMarker(e){if(e in searchMarkerStyles){var n=searchMarkerStyles[e].icon;n?searchMarker.setIcon({url:n,scaledSize:new google.maps.Size(24,24)}):searchMarker.setIcon(n),Store.set("searchMarkerStyle",e)}return searchMarker}function createSearchMarker(){var e=new google.maps.Marker({position:{lat:centerLat,lng:centerLng},map:map,animation:google.maps.Animation.DROP,draggable:!Store.get("lockMarker"),icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+1});e.infoWindow=new google.maps.InfoWindow({content:"<div><b>Search Location</b></div>",disableAutoPan:!0}),addListeners(e);var n=null;return google.maps.event.addListener(e,"dragstart",function(){n=e.getPosition()}),google.maps.event.addListener(e,"dragend",function(){var t=e.getPosition();changeSearchLocation(t.lat(),t.lng()).done(function(){n=null}).fail(function(){n&&e.setPosition(n)})}),e}function searchControl(e){$.post(searchControlURI+"?action="+encodeURIComponent(e)),$("#scan-here").toggleClass("disabled","off"===e)}function updateSearchStatus(){$.getJSON(searchControlURI).then(function(e){$("#search-switch").prop("checked",e.status),$("#scan-here").toggleClass("disabled",!e.status)})}function initSidebar(){$("#gyms-switch").prop("checked",Store.get("showGyms")),$("#gym-sidebar-switch").prop("checked",Store.get("useGymSidebar")),$("#gym-sidebar-wrapper").toggle(Store.get("showGyms")),$("#gyms-filter-wrapper").toggle(Store.get("showGyms")),$("#team-gyms-only-switch").val(Store.get("showTeamGymsOnly")),$("#open-gyms-only-switch").prop("checked",Store.get("showOpenGymsOnly")),$("#min-level-gyms-filter-switch").val(Store.get("minGymLevel")),$("#max-level-gyms-filter-switch").val(Store.get("maxGymLevel")),$("#last-update-gyms-switch").val(Store.get("showLastUpdatedGymsOnly")),$("#pokemon-switch").prop("checked",Store.get("showPokemon")),$("#pokestops-switch").prop("checked",Store.get("showPokestops")),$("#lured-pokestops-only-switch").val(Store.get("showLuredPokestopsOnly")),$("#lured-pokestops-only-wrapper").toggle(Store.get("showPokestops")),$("#geoloc-switch").prop("checked",Store.get("geoLocate")),$("#lock-marker-switch").prop("checked",Store.get("lockMarker")),$("#start-at-user-location-switch").prop("checked",Store.get("startAtUserLocation")),$("#follow-my-location-switch").prop("checked",Store.get("followMyLocation")),$("#scan-here-switch").prop("checked",Store.get("scanHere")),$("#scan-here").toggle(Store.get("scanHere")),$("#scanned-switch").prop("checked",Store.get("showScanned")),$("#spawnpoints-switch").prop("checked",Store.get("showSpawnpoints")),$("#ranges-switch").prop("checked",Store.get("showRanges")),$("#sound-switch").prop("checked",Store.get("playSound")),$("#pokemoncries").toggle(Store.get("playSound")),$("#cries-switch").prop("checked",Store.get("playCries"));var e=new google.maps.places.Autocomplete(document.getElementById("next-location"));$("#next-location").css("background-color",$("#geoloc-switch").prop("checked")?"#e0e0e0":"#ffffff"),$("#search-switch").length&&(updateSearchStatus(),setInterval(updateSearchStatus,5e3)),e.addListener("place_changed",function(){var n=e.getPlace();if(n.geometry){var t=n.geometry.location;changeLocation(t.lat(),t.lng())}}),$("#pokemon-icon-size").val(Store.get("iconSizeModifier"))}function getTypeSpan(e){return"<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.6em; vertical-align: middle; background-color: "+e.color+"'>"+e.type+"</span>"}function openMapDirections(e,n){var t="https://www.google.com/maps/?daddr="+e+","+n;window.open(t,"_blank")}function getDateStr(e){var n="Unknown";return e&&(n=moment(e).fromNow()),n}function pokemonLabel(e){var n=e.pokemon_name,t=e.pokemon_rarity?"("+e.pokemon_rarity+")":"",a=e.pokemon_types,o="",i=e.encounter_id,s=e.pokemon_id,r=e.latitude,l=e.longitude,c=e.disappear_time,p=e.individual_attack,d=e.individual_defense,m=e.individual_stamina,g=void 0!==moves[e.move_1]?i8ln(moves[e.move_1].name):"gen/unknown",u=void 0!==moves[e.move_2]?i8ln(moves[e.move_2].name):"gen/unknown",k=e.weight,y=e.height,h=e.gender,v=e.form,f=e.cp,w=e.cp_multiplier;$.each(a,function(e,n){o+=getTypeSpan(n)});var S="",M="",_="";if(201===s&&null!==v&&v>0&&(_+="("+unownForm[e.form]+")"),M+="\n    <div class='pokemon name'>\n      "+n+" <span class='pokemon name pokedex'><a href='http://pokemon.gameinfo.io/en/pokemon/"+s+"' target='_blank' title='View in PokÃ©dex'>#"+s+"</a></span> "+_+" <span class='pokemon gender rarity'>"+genderType[h-1]+" "+t+"</span> "+o+"\n    </div>",null!==f&&null!==w){var L=getPokemonLevel(w);if(null!==p&&null!==d&&null!==m)var P=getIv(p,d,m);M+="\n          <div class='pokemon container'>\n            <div class='pokemon container content-left'>\n              <div>\n                <img class='pokemon sprite' src='static/icons/"+s+".png'>\n                <span class='pokemon'>Level: </span><span class='pokemon'>"+L+"</span>\n                <span class='pokemon links exclude'><a href='javascript:excludePokemon("+s+")'>Exclude</a></span>\n                <span class='pokemon links notify'><a href='javascript:notifyAboutPokemon("+s+")'>Notify</a></span>\n                <span class='pokemon links remove'><a href='javascript:removePokemonMarker(\""+i+"\")'>Remove</a></span>\n              </div>\n          </div>\n          <div class='pokemon container content-right'>\n            <div>\n              <div class='pokemon disappear'>\n                <span class='label-countdown' disappears-at='"+c+"'>00m00s</span> left\n              </div>\n              <div class='pokemon'>\n                CP: <span class='pokemon encounter'>"+f+"/"+P.toFixed(1)+"%</span> (A"+p+"/D"+d+"/S"+m+")\n              </div>\n              <div class='pokemon'>\n                Moveset: <span class='pokemon encounter'>"+g+"/"+u+"</span>\n              </div>\n              <div class='pokemon'>\n                Weight: "+k.toFixed(2)+"kg | Height: "+y.toFixed(2)+"m\n              </div>\n              <div>\n                <span class='pokemon navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+r+","+l+");' title='Open in Google Maps'>"+r.toFixed(6)+", "+l.toFixed(7)+"</a></span>\n              </div>\n          </div>\n        </div>\n      </div>"}else M+="\n      <div class='pokemon container'>\n        <div class='pokemon container content-left'>\n          <div>\n            <img class='pokemon sprite' src='static/icons/"+s+".png'>\n            <span class='pokemon'>Level: </span><span class='pokemon no-encounter'>n/a</span>\n            <span class='pokemon links exclude'><a href='javascript:excludePokemon("+s+")'>Exclude</a></span>\n            <span class='pokemon links notify'><a href='javascript:notifyAboutPokemon("+s+")'>Notify</a></span>\n            <span class='pokemon links remove'><a href='javascript:removePokemonMarker(\""+i+"\")'>Remove</a></span>\n          </div>\n      </div>\n      <div class='pokemon container content-right'>\n        <div>\n          <div class='pokemon disappear'>\n            <span class='label-countdown' disappears-at='"+c+"'>00m00s</span> left\n          </div>\n          <div class='pokemon'>\n            CP: <span class='pokemon no-encounter'>No information</span>\n          </div>\n          <div class='pokemon'>\n            Moveset: <span class='pokemon no-encounter'>No information</span>\n          </div>\n          <div class='pokemon'>\n            Weight: <span class='pokemon no-encounter'>n/a</span> | Height: <span class='pokemon no-encounter'>n/a</span>\n          </div>\n          <div>\n            <span class='pokemon navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+r+","+l+");' title='Open in Google Maps'>"+r.toFixed(6)+", "+l.toFixed(7)+"</a></span>\n          </div>\n      </div>\n    </div>\n  </div>";return M+="\n      "}function isOngoingRaid(e){return e&&Date.now()<e.end&&Date.now()>e.start}function gymLabel(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=[3,6,9,59,65,68,89,94,103,110,112,125,126,129,131,134,135,136,143,153,156,159,248],a=e.raid,o="";if(a&&a.end>Date.now()&&null!==a.pokemon_id){var i=void 0!==moves[a.move_1]?i8ln(moves[a.move_1].name):"gen/unknown",s=void 0!==moves[a.move_2]?i8ln(moves[a.move_2].name):"gen/unknown";o+="\n                    <div class='raid encounter'>\n                       CP: <span class='raid encounter info'>"+a.cp+"</span>\n                    </div>\n                    <div class='raid encounter'>\n                         Moveset: <span class='raid encounter info'>"+i+"/"+s+"</span>\n                    </div>"}var r=getDateStr(e.last_scanned),l=getDateStr(e.last_modified),c=e.slots_available?1===e.slots_available?"1 Free Slot":e.slots_available+" Free Slots":"No Free Slots",p=["85,85,85,1","0,134,255,1","255,26,26,1","255,159,25,1"],d=gymTypes[e.team_id],m=null!=a&&Date.now()<a.start,g=isOngoingRaid(a),u="",k="",y="",h="",v="",f=e.total_cp,w=e.name?e.name:0===e.team_id?d:"Team "+d,S="\n      <div class='gym name' style='color:rgba("+p[e.team_id]+")'>\n        "+w+"\n      </div>";if(0!==e.team_id&&(u="\n        <div>\n            <img class='gym info strength' src='static/images/gym/Strength.png'>\n            <span class='gym info strength'>\n              Strength: "+f+" ("+c+")\n            </span>\n        </div>"),m||g){var M=["252,112,176","255,158,22"],_="â".repeat(a.level);if(g&&a.pokemon_id?(k="\n                <img class='gym sprite' src='static/images/raid/unknown.png'>\n                "+o+"\n            ",-1!==t.indexOf(a.pokemon_id)&&(k="\n                    <img class='gym sprite' src='static/images/raid/"+a.pokemon_id+".png'>\n                    "+o+"\n                ")):k="<img class='gym sprite' src='static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+"_"+a.level+".png'>",m)y="\n                <div class='raid'>\n                  <span style='color:rgb("+M[Math.floor((a.level-1)/2)]+")'>\n                  "+_+"\n                  </span>\n                  Raid in <span class='raid countdown label-countdown' disappears-at='"+a.start+"'></span>\n                </div>";else{var L="";$.each(a.pokemon_types,function(e,n){L+=getTypeSpan(n)}),u="\n                <div class='raid'>\n                  <span style='color:rgb("+M[Math.floor((a.level-1)/2)]+")'>\n                  "+_+"\n                  </span>\n                  <span class='raid countdown label-countdown' disappears-at='"+a.end+"'></span> left\n                </div>\n                   <div class='raid pokemon name'>\n                        "+a.pokemon_name+"\n                            <a href='http://pokemon.gameinfo.io/en/pokemon/"+a.pokemon_id+"' target='_blank' title='View in PokÃ©dex'>#"+a.pokemon_id+"</a>\n                        "+L+"\n                </div>"}}else k="<img class='gym sprite' src='static/images/gym/"+d+"_"+getGymLevel(e)+".png'>";return h="\n            <div class='gym container'>\n                <div>\n                  <span class='gym info navigate'>\n                    <a href='javascript:void(0);' onclick='javascript:openMapDirections("+e.latitude+","+e.longitude+");' title='Open in Google Maps'>\n                      "+e.latitude.toFixed(6)+", "+e.longitude.toFixed(7)+"\n                    </a>\n                  </span>\n                </div>\n                <div class='gym info last-scanned'>\n                    Last Scanned: "+r+"\n                </div>\n                <div class='gym info last-modified'>\n                    Last Modified: "+l+"\n                </div>\n            </div>\n        </div>",!g&&n&&(v="<div>",e.pokemon.forEach(function(e){v+="\n            <span class='gym member'>\n              <center>\n                <div>\n                  <div>\n                    <i class='pokemon-sprite n"+e.pokemon_id+"'></i>\n                  </div>\n                  <div>\n                    <span class='gym pokemon'>"+e.pokemon_name+"</span>\n                  </div>\n                  <div>\n                    <img class='gym pokemon motivation heart' src='static/images/gym/Heart.png'> <span class='gym pokemon motivation'>"+e.cp_decayed+"</span>\n                  </div>\n                </div>\n              </center>\n            </span>"}),v+="</div>"),"\n        <div>\n            <center>\n                "+S+"\n                "+u+"\n                "+k+"\n                "+y+"\n            </center>\n            "+h+"\n            <center>\n                "+v+"\n            </center>\n        </div>"}function pokestopLabel(e,n,t){var a;return a=e?"\n            <div>\n              <div class='pokestop lure'>\n                Lured PokÃ©stop\n              </div>\n              <div class='pokestop-expire'>\n                  <span class='label-countdown' disappears-at='"+e+"'>00m00s</span> left\n              </div>\n              <div>\n                <img class='pokestop sprite' src='static/images/pokestop//PokestopLured.png'>\n              </div>\n              <div>\n                <span class='pokestop navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+n+","+t+");' title='Open in Google Maps'; class='pokestop lure'>"+n.toFixed(6)+", "+t.toFixed(7)+"</a></span>\n              </div>\n            </div>\n          </div>":"\n            <div>\n              <div class='pokestop nolure'>\n                PokÃ©stop\n              </div>\n              <div>\n                <img class='pokestop sprite' src='static/images/pokestop//Pokestop.png'>\n              </div>\n              <div>\n                <span class='pokestop navigate'><a href='javascript:void(0);' onclick='javascript:openMapDirections("+n+","+t+");' title='Open in Google Maps'; class='pokestop nolure'>"+n.toFixed(6)+", "+t.toFixed(7)+"</a></span>\n              </div>\n            </div>\n          </div>"}function formatSpawnTime(e){return("0"+Math.floor((e+3600)%3600/60)).substr(-2)+":"+("0"+e%60).substr(-2)}function spawnpointLabel(e){var n="\n        <div>\n            <b>Spawn Point</b>\n        </div>";return e.uncertain?n+="\n            <div>\n                Spawn times not yet determined. Current guess "+formatSpawnTime(e.appear_time)+" until "+formatSpawnTime(e.disappear_time)+"\n            </div>":n+="\n            <div>\n                Every hour from "+formatSpawnTime(e.appear_time)+" to "+formatSpawnTime(e.disappear_time)+"\n            </div>",n}function addRangeCircle(e,n,t,a){var o=null,i=new google.maps.LatLng(e.position.lat(),e.position.lng()),s=["#999999","#0051CF","#FF260E","#FECC23"],r=s[0];a&&(r=s[a]);var l,c;switch(t){case"pokemon":c="#C233F2",l=40;break;case"pokestop":c="#3EB0FF",l=40;break;case"gym":c=r,l=40}n&&(o=n);var p={map:o,radius:l,strokeWeight:1,strokeColor:c,strokeOpacity:.9,center:i,fillColor:c,fillOpacity:.3};return new google.maps.Circle(p)}function isRangeActive(e){return!(e.getZoom()<16)&&Store.get("showRanges")}function getIv(e,n,t){return null!==e&&100*(e+n+t)/45}function getPokemonLevel(e){if(e<.734)var n=58.35178527*e*e-2.838007664*e+.8539209906;else n=171.0112688*e-95.20425243;return n=2*Math.round(n)/2}function getGymLevel(e){return 6-e.slots_available}function lpad(e,n,t){return Array(Math.max(n-String(e).length+1,0)).join(t)+e}function repArray(e,n,t){for(var a=0;a<n.length;a++)e=e.replace(n[a],t[a]);return e}function getTimeUntil(e){var n=+new Date,t=e-n,a=Math.floor(t/1e3%60),o=Math.floor(t/1e3/60%60);return{total:t,hour:Math.floor(t/36e5%24),min:o,sec:a,now:n,ttime:e}}function getNotifyText(e){var n=getIv(e.individual_attack,e.individual_defense,e.individual_stamina),t=["<prc>","<pkm>","<atk>","<def>","<sta>"],a=[n?n.toFixed(1):"",e.pokemon_name,e.individual_attack,e.individual_defense,e.individual_stamina],o=repArray(n?notifyIvTitle:notifyNoIvTitle,t,a),i=new Date(e.disappear_time).toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),s=getTimeUntil(e.disappear_time),r=s.hour>0?s.hour+":":"";return r+=lpad(s.min,2,0)+"m"+lpad(s.sec,2,0)+"s",{fav_title:o,fav_text:repArray(notifyText,t=["<dist>","<udist>"],a=[i,r])}}function playPokemonSound(e){Store.get("playSound")&&(Store.get("playCries")?new Audio("static/sounds/cries/"+e+".wav").play().catch(function(n){n&&(console.log("Sound for PokÃ©mon "+e+" is missing, using generic sound instead."),audio.play())}):audio.play())}function customizePokemonMarker(e,n,t){var a=getNotifyText(n);if(e.addListener("click",function(){this.setAnimation(null),this.animationDisabled=!0}),!e.rangeCircle&&isRangeActive(map)&&(e.rangeCircle=addRangeCircle(e,map,"pokemon")),e.infoWindow=new google.maps.InfoWindow({content:pokemonLabel(n),disableAutoPan:!0}),(notifiedPokemon.indexOf(n.pokemon_id)>-1||notifiedRarity.indexOf(n.pokemon_rarity)>-1)&&(t||(playPokemonSound(n.pokemon_id),sendNotification(a.fav_title,a.fav_text,"static/icons/"+n.pokemon_id+".png",n.latitude,n.longitude)),!0!==e.animationDisabled&&e.setAnimation(google.maps.Animation.BOUNCE)),null!=n.individual_attack){var o=getIv(n.individual_attack,n.individual_defense,n.individual_stamina);notifiedMinPerfection>0&&o>=notifiedMinPerfection&&(t||(playPokemonSound(n.pokemon_id),sendNotification(a.fav_title,a.fav_text,"static/icons/"+n.pokemon_id+".png",n.latitude,n.longitude)),!0!==e.animationDisabled&&e.setAnimation(google.maps.Animation.BOUNCE))}addListeners(e)}function setupGymMarker(e){var n=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map});return n.infoWindow=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),updateGymMarker(e,n),!n.rangeCircle&&isRangeActive(map)&&(n.rangeCircle=addRangeCircle(n,map,"gym",e.team_id)),Store.get("useGymSidebar")?(n.addListener("click",function(){var n=document.querySelector("#gym-details");n.getAttribute("data-id")===e.gym_id&&n.classList.contains("visible")?n.classList.remove("visible"):(n.setAttribute("data-id",e.gym_id),showGymDetails(e.gym_id))}),google.maps.event.addListener(n.infoWindow,"closeclick",function(){n.persist=null}),isMobileDevice()||isTouchDevice()||n.addListener("mouseover",function(){n.infoWindow.open(map,n),clearSelection(),updateLabelDiffTime()}),n.addListener("mouseout",function(){n.persist||n.infoWindow.close()})):addListeners(n),n}function updateGymMarker(e,n){return null!==e.raid&&e.raid.end>Date.now()&&null!==e.raid.pokemon_id?(n.setIcon({url:"static/images/raid/"+e.raid.pokemon_id+".png",scaledSize:new google.maps.Size(48,48)}),n.setZIndex(google.maps.Marker.MAX_ZINDEX+1)):null!==e.raid&&e.raid.end>Date.now()?n.setIcon({url:"static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+"_"+e.raid.level+".png",scaledSize:new google.maps.Size(48,48)}):(n.setIcon({url:"static/images/gym/"+gymTypes[e.team_id]+"_"+getGymLevel(e)+".png",scaledSize:new google.maps.Size(48,48)}),n.setZIndex(1)),n.infoWindow.setContent(gymLabel(e)),n}function setupPokestopMarker(e){var n={url:"static/images/pokestop/"+(e.lure_expiration?"PokestopLured":"Pokestop")+".png",scaledSize:new google.maps.Size(32,32)},t=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map,zIndex:e.lure_expiration?3:2,icon:n});return!t.rangeCircle&&isRangeActive(map)&&(t.rangeCircle=addRangeCircle(t,map,"pokestop")),t.infoWindow=new google.maps.InfoWindow({content:pokestopLabel(e.lure_expiration,e.latitude,e.longitude),disableAutoPan:!0}),addListeners(t),t}function getColorByDate(e){var n=(Date.now()-e)/1e3/60/15;return n>1&&(n=1),["hsl(",(120*(1-n)).toString(10),",100%,50%)"].join("")}function setupScannedMarker(e){var n=new google.maps.LatLng(e.latitude,e.longitude);return new google.maps.Circle({map:map,clickable:!1,center:n,radius:!0===showConfig.pokemons?70:450,fillColor:getColorByDate(e.last_modified),fillOpacity:.1,strokeWeight:1,strokeOpacity:.5})}function getColorBySpawnTime(e){var n=new Date,t=60*n.getMinutes()+n.getSeconds();t<900&&e>2700?t+=3600:t>2700&&e<900&&(e+=3600);var a=t-e,o=275;return a>=0&&a<=1800?o=120*(1-a/60/30):a<0&&a>-300&&(o=50*(1- -a/60/5)+200),o=5*Math.round(o/5)}function changeSpawnIcon(e,n){var t="";t=275===e?"./static/icons/hsl-275-light.png":"./static/icons/hsl-"+e+".png";var a=1.6,o=1,i=Math.round(1.6*(n-10));return i<1&&(i=1),{url:t,scaledSize:new google.maps.Size(i,i),anchor:new google.maps.Point(i/2,i/2)}}function spawnPointIndex(e){var n=1,t=0;return e>=0&&e<=120?n=100+100*(t=e/120):e>=200&&e<=250&&(n=100*(t=(e-200)/50)),n}function setupSpawnpointMarker(e){var n=new google.maps.LatLng(e.latitude,e.longitude),t=getColorBySpawnTime(e.appear_time),a=map.getZoom(),o=new google.maps.Marker({map:map,position:n,icon:changeSpawnIcon(t,a),zIndex:spawnPointIndex(t)});return o.infoWindow=new google.maps.InfoWindow({content:spawnpointLabel(e),disableAutoPan:!0,position:n}),addListeners(o),o}function clearSelection(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function addListeners(e){return e.addListener("click",function(){e.infoWindowIsOpen?(e.persist=null,e.infoWindow.close(),e.infoWindowIsOpen=!1):(e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime(),e.persist=!0,e.infoWindowIsOpen=!0)}),google.maps.event.addListener(e.infoWindow,"closeclick",function(){e.persist=null}),isMobileDevice()||isTouchDevice()||e.addListener("mouseover",function(){e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime()}),e.addListener("mouseout",function(){e.persist||e.infoWindow.close()}),e}function clearStaleMarkers(){$.each(mapData.pokemons,function(e,n){(mapData.pokemons[e].disappear_time<(new Date).getTime()||excludedPokemon.indexOf(mapData.pokemons[e].pokemon_id)>=0)&&(mapData.pokemons[e].marker.rangeCircle&&(mapData.pokemons[e].marker.rangeCircle.setMap(null),delete mapData.pokemons[e].marker.rangeCircle),mapData.pokemons[e].marker.setMap(null),delete mapData.pokemons[e])}),$.each(mapData.lurePokemons,function(e,n){(mapData.lurePokemons[e].lure_expiration<(new Date).getTime()||excludedPokemon.indexOf(mapData.lurePokemons[e].pokemon_id)>=0)&&(mapData.lurePokemons[e].marker.setMap(null),delete mapData.lurePokemons[e])}),$.each(mapData.scanned,function(e,n){mapData.scanned[e].last_modified<(new Date).getTime()-9e5&&(mapData.scanned[e].marker.setMap(null),delete mapData.scanned[e])})}function showInBoundsMarkers(e,n){$.each(e,function(t,a){var o=e[t].marker,i=!1;e[t].hidden||("function"==typeof o.getBounds?map.getBounds().intersects(o.getBounds())&&(i=!0):"function"==typeof o.getPosition&&map.getBounds().contains(o.getPosition())&&(i=!0)),i&&-1!==rangeMarkers.indexOf(n)&&(o.rangeCircle?isRangeActive(map)?o.rangeCircle.setMap(map):o.rangeCircle.setMap(null):isRangeActive(map)&&(o.rangeCircle="gym"===n?addRangeCircle(o,map,n,e[t].team_id):addRangeCircle(o,map,n))),i&&!o.getMap()?(o.setMap(map),o.setAnimation&&o.oldAnimation&&o.setAnimation(o.oldAnimation)):!i&&o.getMap()&&(o.getAnimation&&(o.oldAnimation=o.getAnimation()),o.rangeCircle&&o.rangeCircle.setMap(null),o.setMap(null))})}function loadRawData(){var e=Store.get("showPokemon"),n=Store.get("showGyms"),t=Store.get("showPokestops"),a=Store.get("showScanned"),o=Store.get("showSpawnpoints"),i=Boolean(Store.get("showLuredPokestopsOnly")),s=map.getBounds(),r=s.getSouthWest(),l=s.getNorthEast(),c=r.lat(),p=r.lng(),d=l.lat(),m=l.lng();return $.ajax({url:"raw_data",type:"GET",data:{timestamp:timestamp,pokemon:e,lastpokemon:lastpokemon,pokestops:t,lastpokestops:lastpokestops,luredonly:i,gyms:n,lastgyms:lastgyms,scanned:a,lastslocs:lastslocs,spawnpoints:o,lastspawns:lastspawns,swLat:c,swLng:p,neLat:d,neLng:m,oSwLat:oSwLat,oSwLng:oSwLng,oNeLat:oNeLat,oNeLng:oNeLng,reids:String(reincludedPokemon),eids:String(excludedPokemon)},dataType:"json",cache:!1,beforeSend:function e(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},error:function e(){toastr.error("Please check connectivity or reduce marker settings.","Error getting data"),toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"25000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}},complete:function e(){rawDataIsLoading=!1}})}function processPokemons(e,n){if(!Store.get("showPokemon"))return!1;!(n.encounter_id in mapData.pokemons)&&excludedPokemon.indexOf(n.pokemon_id)<0&&n.disappear_time>Date.now()&&(n.marker&&n.marker.setMap(null),n.hidden||(n.marker=setupPokemonMarker(n,map),customizePokemonMarker(n.marker,n),mapData.pokemons[n.encounter_id]=n))}function processPokestops(e,n){if(!Store.get("showPokestops"))return!1;if(Store.get("showLuredPokestopsOnly")&&!n.lure_expiration)return!0;if(mapData.pokestops[n.pokestop_id]){var t=mapData.pokestops[n.pokestop_id];!!n.lure_expiration!=!!t.lure_expiration&&(t.marker&&t.marker.rangeCircle&&t.marker.rangeCircle.setMap(null),t.marker.setMap(null),n.marker=setupPokestopMarker(n),mapData.pokestops[n.pokestop_id]=n)}else n.marker&&n.marker.rangeCircle&&n.marker.rangeCircle.setMap(null),n.marker&&n.marker.setMap(null),n.marker=setupPokestopMarker(n),mapData.pokestops[n.pokestop_id]=n}function updatePokestops(){if(!Store.get("showPokestops"))return!1;var e=[],n=(new Date).getTime();$.each(mapData.pokestops,function(e,t){t.lure_expiration&&t.lure_expiration<n&&(t.lure_expiration=null,t.marker&&t.marker.rangeCircle&&t.marker.rangeCircle.setMap(null),t.marker.setMap(null),t.marker=setupPokestopMarker(t))}),Store.get("showLuredPokestopsOnly")&&($.each(mapData.pokestops,function(n,t){t.lure_expiration||e.push(n)}),$.each(e,function(e,n){mapData.pokestops[n]&&mapData.pokestops[n].marker&&(mapData.pokestops[n].marker.rangeCircle&&mapData.pokestops[n].marker.rangeCircle.setMap(null),mapData.pokestops[n].marker.setMap(null),delete mapData.pokestops[n])}))}function processGyms(e,n){var t=getGymLevel(n);if(!Store.get("showGyms"))return!1;var a=function e(n){mapData.gyms[n]&&mapData.gyms[n].marker&&(mapData.gyms[n].marker.rangeCircle&&mapData.gyms[n].marker.rangeCircle.setMap(null),mapData.gyms[n].marker.setMap(null),delete mapData.gyms[n])};if(Store.get("showOpenGymsOnly")&&0===n.slots_available)return a(n.gym_id),!0;if(Store.get("showTeamGymsOnly")&&Store.get("showTeamGymsOnly")!==n.team_id)return a(n.gym_id),!0;if(Store.get("showLastUpdatedGymsOnly")){var o=new Date;if(3600*Store.get("showLastUpdatedGymsOnly")*1e3+n.last_scanned<o.getTime())return a(n.gym_id),!0}return t<Store.get("minGymLevel")?(a(n.gym_id),!0):t>Store.get("maxGymLevel")?(a(n.gym_id),!0):(n.gym_id in mapData.gyms?n.marker=updateGymMarker(n,mapData.gyms[n.gym_id].marker):n.marker=setupGymMarker(n),void(mapData.gyms[n.gym_id]=n))}function processScanned(e,n){if(!Store.get("showScanned"))return!1;var t=n.latitude+"|"+n.longitude;t in mapData.scanned?mapData.scanned[t].last_modified=n.last_modified:(n.marker&&n.marker.setMap(null),n.marker=setupScannedMarker(n),mapData.scanned[t]=n)}function updateScanned(){if(!Store.get("showScanned"))return!1;$.each(mapData.scanned,function(e,n){map.getBounds().intersects(n.marker.getBounds())&&n.marker.setOptions({fillColor:getColorByDate(n.last_modified)})})}function processSpawnpoints(e,n){if(!Store.get("showSpawnpoints"))return!1;var t=n.id;t in mapData.spawnpoints||(n.marker&&n.marker.setMap(null),n.marker=setupSpawnpointMarker(n),mapData.spawnpoints[t]=n)}function updateSpawnPoints(){if(!Store.get("showSpawnpoints"))return!1;var e=map.getZoom();$.each(mapData.spawnpoints,function(n,t){if(map.getBounds().contains(t.marker.getPosition())){var a=getColorBySpawnTime(t.appear_time);t.marker.setIcon(changeSpawnIcon(a,e)),t.marker.setZIndex(spawnPointIndex(a))}})}function updateMap(){loadRawData().done(function(e){$.each(e.pokemons,processPokemons),$.each(e.pokestops,processPokestops),$.each(e.gyms,processGyms),$.each(e.scanned,processScanned),$.each(e.spawnpoints,processSpawnpoints),showInBoundsMarkers(mapData.pokemons,"pokemon"),showInBoundsMarkers(mapData.lurePokemons,"pokemon"),showInBoundsMarkers(mapData.gyms,"gym"),showInBoundsMarkers(mapData.pokestops,"pokestop"),showInBoundsMarkers(mapData.scanned,"scanned"),showInBoundsMarkers(mapData.spawnpoints,"inbound"),clearStaleMarkers(),updateScanned(),updateSpawnPoints(),updatePokestops(),$("#stats").hasClass("visible")&&countMarkers(map),oSwLat=e.oSwLat,oSwLng=e.oSwLng,oNeLat=e.oNeLat,oNeLng=e.oNeLng,lastgyms=e.lastgyms,lastpokestops=e.lastpokestops,lastpokemon=e.lastpokemon,lastslocs=e.lastslocs,lastspawns=e.lastspawns,(reids=e.reids)instanceof Array&&(reincludedPokemon=reids.filter(function(e){return this.indexOf(e)<0},reincludedPokemon)),timestamp=e.timestamp,lastUpdateTime=Date.now()})}function redrawPokemon(e){var n=!0;$.each(e,function(n,t){var a=e[n];if(!a.hidden){a.marker.rangeCircle&&a.marker.rangeCircle.setMap(null);var o=setupPokemonMarker(a,map,this.marker.animationDisabled);customizePokemonMarker(o,a,!0),a.marker.setMap(null),e[n].marker=o}})}function getPointDistance(e,n){return google.maps.geometry.spherical.computeDistanceBetween(e,n)}function sendNotification(e,n,t,a,o){if(!("Notification"in window))return!1;if("granted"!==Notification.permission)Notification.requestPermission();else{var i=new Notification(e,{icon:t,body:n,sound:"sounds/ding.mp3"});i.onclick=function(){window.focus(),i.close(),centerMap(a,o,20)}}}function createMyLocationButton(){var e=document.createElement("div"),n=document.createElement("button");n.style.backgroundColor="#fff",n.style.border="none",n.style.outline="none",n.style.width="28px",n.style.height="28px",n.style.borderRadius="2px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.cursor="pointer",n.style.marginRight="10px",n.style.padding="0px",n.title="My Location",e.appendChild(n);var t=document.createElement("div");t.style.margin="5px",t.style.width="18px",t.style.height="18px",t.style.backgroundImage="url(static/mylocation-sprite-1x.png)",t.style.backgroundSize="180px 18px",t.style.backgroundPosition="0px 0px",t.style.backgroundRepeat="no-repeat",t.id="current-location",n.appendChild(t),n.addEventListener("click",function(){centerMapOnLocation()}),e.index=1,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),google.maps.event.addListener(map,"dragend",function(){document.getElementById("current-location").style.backgroundPosition="0px 0px"})}function centerMapOnLocation(){var e=document.getElementById("current-location"),n="0",t=setInterval(function(){n="-18"===n?"0":"-18",e.style.backgroundPosition=n+"px 0"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var a=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);locationMarker.setPosition(a),map.setCenter(a),Store.set("followMyLocationPosition",{lat:n.coords.latitude,lng:n.coords.longitude}),clearInterval(t),e.style.backgroundPosition="-144px 0px"}):(clearInterval(t),e.style.backgroundPosition="0px 0px")}function changeLocation(e,n){var t=new google.maps.LatLng(e,n);changeSearchLocation(e,n).done(function(){map.setCenter(t),searchMarker.setPosition(t)})}function changeSearchLocation(e,n){return $.post("next_loc?lat="+e+"&lon="+n,{})}function centerMap(e,n,t){var a=new google.maps.LatLng(e,n);map.setCenter(a),t&&(storeZoom=!1,map.setZoom(t))}function i8ln(e){return $.isEmptyObject(i8lnDictionary)&&"en"!==language&&languageLookups<languageLookupThreshold&&$.ajax({url:"static/dist/locales/"+language+".min.json",dataType:"json",async:!1,success:function e(n){i8lnDictionary=n},error:function e(n,t,a){console.log("Error loading i8ln dictionary: "+a),languageLookups++}}),e in i8lnDictionary?i8lnDictionary[e]:e}function updateGeoLocation(){navigator.geolocation&&(Store.get("geoLocate")||Store.get("followMyLocation"))&&navigator.geolocation.getCurrentPosition(function(e){var n=e.coords.latitude,t=e.coords.longitude,a=new google.maps.LatLng(n,t);Store.get("geoLocate")&&void 0!==searchMarker&&getPointDistance(searchMarker.getPosition(),a)>40&&$.post("next_loc?lat="+n+"&lon="+t).done(function(){map.panTo(a),searchMarker.setPosition(a)}),Store.get("followMyLocation")&&void 0!==locationMarker&&getPointDistance(locationMarker.getPosition(),a)>=5&&(map.panTo(a),locationMarker.setPosition(a),Store.set("followMyLocationPosition",{lat:n,lng:t}))})}function createUpdateWorker(){try{if(isMobileDevice()&&window.Worker){var e=new Blob(["onmessage = function(e) {\n                var data = e.data\n                if (data.name === 'backgroundUpdate') {\n                    self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\n                }\n            }"]),n=window.URL.createObjectURL(e);(updateWorker=new Worker(n)).onmessage=function(e){var n=e.data;document.hidden&&"backgroundUpdate"===n.name&&Date.now()-lastUpdateTime>2500&&(updateMap(),updateGeoLocation())},updateWorker.postMessage({name:"backgroundUpdate"})}}catch(e){console.log("Webworker error: "+e.message)}}function showGymDetails(e){var n=document.querySelector("#gym-details"),t;n.classList.add("visible"),$.ajax({url:"gym_data",type:"GET",data:{id:e},dataType:"json",cache:!1}).done(function(e){var a="";e.pokemon.length?isOngoingRaid(e.raid)||(e.pokemon.forEach(function(e){a+=getSidebarGymMember(e)}),a="<table><tbody>"+a+"</tbody></table>"):a=0===e.team_id?"":'\n                <center>\n                    Gym Leader:<br>\n                    <i class="pokemon-large-sprite n'+e.guard_pokemon_id+'"></i><br>\n                    <b>'+e.guard_pokemon_name+'</b>\n\n                    <p style="font-size: .75em; margin: 5px;">\n                        No additional gym information is available for this gym. Make sure you are collecting <a href="https://rocketmap.readthedocs.io/en/develop/extras/gyminfo.html">detailed gym info.</a>\n                        If you have detailed gym info collection running, this gym\'s Pokemon information may be out of date.\n                    </p>\n                </center>\n            ';var o=gymLabel(e,!1);n.innerHTML=""+o+a,(t=document.createElement("a")).href="#",t.className="close",t.tabIndex=0,n.appendChild(t),t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),n.classList.remove("visible")})})}function getSidebarGymMember(e){var n=getIv(e.iv_attack,e.iv_defense,e.iv_stamina),t=Math.round(100/e.move_2_energy);return'\n                    <tr onclick=toggleGymPokemonDetails(this)>\n                        <td width="30px">\n                            <img class="gym pokemon sprite" src="static/icons/'+e.pokemon_id+'.png">\n                        </td>\n                        <td>\n                            <div class="gym pokemon" style="line-height:0.5em;">'+e.pokemon_name+'</div>\n                            <div><img class="gym pokemon motivation heart" src="static/images/gym/Heart.png"> <span class="gym pokemon motivation">'+e.cp_decayed+'</span></div>\n                        </td>\n                        <td width="190" align="center">\n                            <div class="gym pokemon" style="line-height:1em;">'+e.trainer_name+" ("+e.trainer_level+')</div>\n                            <div class="gym pokemon">Deployed '+getDateStr(e.deployment_time)+'</div>\n                        </td>\n                        <td width="10">\n                            \x3c!--<a href="#" onclick="toggleGymPokemonDetails(this)">--\x3e\n                                <i class="fa fa-angle-double-down"></i>\n                            \x3c!--</a>--\x3e\n                        </td>\n                    </tr>\n                    <tr class="details">\n                        <td colspan="2">\n                            <div class="ivs">\n                                <div class="iv">\n                                    <div class="type">ATK</div>\n                                    <div class="value">\n                                        '+e.iv_attack+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">DEF</div>\n                                    <div class="value">\n                                        '+e.iv_defense+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">STA</div>\n                                    <div class="value">\n                                        '+e.iv_stamina+'\n                                    </div>\n                                </div>\n                                <div class="iv" style="width: 36px;"">\n                                    <div class="type">PERFECT</div>\n                                    <div class="value">\n                                        '+n.toFixed(0)+'<span style="font-size: .6em;">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                        <td colspan="2">\n                            <div class="moves">\n                                <div class="move">\n                                    <div class="name">\n                                        '+e.move_1_name+'\n                                        <div class="type '+e.move_1_type.type_en.toLowerCase()+'">'+e.move_1_type.type+'</div>\n                                    </div>\n                                    <div class="damage">\n                                        '+e.move_1_damage+'\n                                    </div>\n                                </div>\n                                <br>\n                                <div class="move">\n                                    <div class="name">\n                                        '+e.move_2_name+'\n                                        <div class="type '+e.move_2_type.type_en.toLowerCase()+'">'+e.move_2_type.type+'</div>\n                                        <div>\n                                            <i class="move-bar-sprite move-bar-sprite-'+t+'"></i>\n                                        </div>\n                                    </div>\n                                    <div class="damage">\n                                        '+e.move_2_damage+"\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                    "}function toggleGymPokemonDetails(e){e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-up"),e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-down"),e.nextElementSibling.classList.toggle("visible")}function getParameterByName(e,n){n||(n=window.location.search),e=e.replace(/[[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}var $selectExclude,$selectPokemonNotify,$selectRarityNotify,$textPerfectionNotify,$selectStyle,$selectIconSize,$switchOpenGymsOnly,$selectTeamGymsOnly,$selectLastUpdateGymsOnly,$selectMinGymLevel,$selectMaxGymLevel,$selectLuredPokestopsOnly,$selectSearchIconMarker,$selectLocationIconMarker,$switchGymSidebar,language=""===document.documentElement.lang?"en":document.documentElement.lang,idToPokemon={},i8lnDictionary={},languageLookups=0,languageLookupThreshold=3,searchMarkerStyles,timestamp,excludedPokemon=[],notifiedPokemon=[],notifiedRarity=[],notifiedMinPerfection=null,buffer=[],reincludedPokemon=[],reids=[],map,rawDataIsLoading=!1,locationMarker,rangeMarkers=["pokemon","pokestop","gym"],searchMarker,storeZoom=!0,moves,oSwLat,oSwLng,oNeLat,oNeLng,lastpokestops,lastgyms,lastpokemon,lastslocs,lastspawns,selectedStyle="light",updateWorker,lastUpdateTime,gymTypes=["Uncontested","Mystic","Valor","Instinct"],audio=new Audio("static/sounds/ding.mp3"),genderType=["â","â","â²"],unownForm=["unset","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","!","?"],notifyIvTitle="<pkm> <prc>% (<atk>/<def>/<sta>)",notifyNoIvTitle="<pkm>",notifyText="disappears at <dist> (<udist>)",searchControlURI="search_control",updateLabelDiffTime=function e(){$(".label-countdown").each(function(e,n){var t=getTimeUntil(parseInt(n.getAttribute("disappears-at"))),a=t.hour,o=t.min,i=t.sec,s="";t.ttime<t.now?s="(expired)":(s="",a>0&&(s=a+"hour "),s+=lpad(o,2,0)+"min ",s+=lpad(i,2,0)+"sec ",s+=""),$(n).text(s)})};$(function(){Notification?"granted"!==Notification.permission&&Notification.requestPermission():console.log("could not load notifications")}),$(function(){$selectStyle=$("#map-style"),$.getJSON("static/dist/data/mapstyle.min.json").done(function(e){var n=[];$.each(e,function(e,t){n.push({id:e,text:i8ln(t)})}),$selectStyle.select2({placeholder:"Select Style",data:n,minimumResultsForSearch:1/0}),$selectStyle.on("change",function(e){selectedStyle=$selectStyle.val(),map.setMapTypeId(selectedStyle),Store.set("map_style",selectedStyle)}),$selectStyle.val(Store.get("map_style")).trigger("change")}),($selectIconSize=$("#pokemon-icon-size")).select2({placeholder:"Select Icon Size",minimumResultsForSearch:1/0}),$selectIconSize.on("change",function(){Store.set("iconSizeModifier",this.value),redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),($switchOpenGymsOnly=$("#open-gyms-only-switch")).on("change",function(){Store.set("showOpenGymsOnly",this.checked),lastgyms=!1,updateMap()}),($selectTeamGymsOnly=$("#team-gyms-only-switch")).select2({placeholder:"Only Show Gyms For Team",minimumResultsForSearch:1/0}),$selectTeamGymsOnly.on("change",function(){Store.set("showTeamGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectLastUpdateGymsOnly=$("#last-update-gyms-switch")).select2({placeholder:"Only Show Gyms Last Updated",minimumResultsForSearch:1/0}),$selectLastUpdateGymsOnly.on("change",function(){Store.set("showLastUpdatedGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectMinGymLevel=$("#min-level-gyms-filter-switch")).select2({placeholder:"Minimum Gym Level",minimumResultsForSearch:1/0}),$selectMinGymLevel.on("change",function(){Store.set("minGymLevel",this.value),lastgyms=!1,updateMap()}),($selectMaxGymLevel=$("#max-level-gyms-filter-switch")).select2({placeholder:"Maximum Gym Level",minimumResultsForSearch:1/0}),$selectMaxGymLevel.on("change",function(){Store.set("maxGymLevel",this.value),lastgyms=!1,updateMap()}),($selectLuredPokestopsOnly=$("#lured-pokestops-only-switch")).select2({placeholder:"Only Show Lured Pokestops",minimumResultsForSearch:1/0}),$selectLuredPokestopsOnly.on("change",function(){Store.set("showLuredPokestopsOnly",this.value),lastpokestops=!1,updateMap()}),($switchGymSidebar=$("#gym-sidebar-switch")).on("change",function(){Store.set("useGymSidebar",this.checked),lastgyms=!1,$.each(["gyms"],function(e,n){$.each(mapData[n],function(e,t){mapData[n][e].marker.rangeCircle&&(mapData[n][e].marker.rangeCircle.setMap(null),delete mapData[n][e].marker.rangeCircle),mapData[n][e].marker.setMap(null)}),mapData[n]={}}),updateMap()}),$selectSearchIconMarker=$("#iconmarker-style"),$selectLocationIconMarker=$("#locationmarker-style"),$.getJSON("static/dist/data/searchmarkerstyle.min.json").done(function(e){searchMarkerStyles=e;var n=[];$.each(e,function(e,t){n.push({id:e,text:t.name})}),$selectSearchIconMarker.select2({placeholder:"Select Icon Marker",data:n,minimumResultsForSearch:1/0}),$selectSearchIconMarker.on("change",function(e){var n=$selectSearchIconMarker.val();Store.set("searchMarkerStyle",n),updateSearchMarker(n)}),$selectSearchIconMarker.val(Store.get("searchMarkerStyle")).trigger("change"),updateSearchMarker(Store.get("lockMarker")),$selectLocationIconMarker.select2({placeholder:"Select Location Marker",data:n,minimumResultsForSearch:1/0}),$selectLocationIconMarker.on("change",function(e){Store.set("locationMarkerStyle",this.value),updateLocationMarker(this.value)}),$selectLocationIconMarker.val(Store.get("locationMarkerStyle")).trigger("change")})}),$(function(){function e(e){return e.id?$('<span><i class="pokemon-sprite n'+e.element.value.toString()+'"></i> '+e.text+"</span>"):e.text}function n(e,n,t){return function(){Store.set(t,this.checked),this.checked?("showPokemon"===t?lastpokemon=!1:"showGyms"===t?lastgyms=!1:"showPokestops"===t?lastpokestops=!1:"showScanned"===t?lastslocs=!1:"showSpawnpoints"===t&&(lastspawns=!1),updateMap()):($.each(n,function(n,a){$.each(e[a],function(n,o){e[a][n].marker.rangeCircle&&(e[a][n].marker.rangeCircle.setMap(null),delete e[a][n].marker.rangeCircle),"showRanges"!==t&&e[a][n].marker.setMap(null)}),"showRanges"!==t&&(e[a]={})}),"showRanges"===t&&updateMap())}}moment.locale(language),Store.get("startAtUserLocation")&&centerMapOnLocation(),$.getJSON("static/dist/data/moves.min.json").done(function(e){moves=e}),$selectExclude=$("#exclude-pokemon"),$selectPokemonNotify=$("#notify-pokemon"),$selectRarityNotify=$("#notify-rarity"),$textPerfectionNotify=$("#notify-perfection");var t=493;$.getJSON("static/dist/data/pokemon.min.json").done(function(n){var t=[];$.each(n,function(e,n){if(e>493)return!1;var a=[];t.push({id:e,text:i8ln(n.name)+" - #"+e}),n.name=i8ln(n.name),n.rarity=i8ln(n.rarity),$.each(n.types,function(e,n){a.push({type:i8ln(n.type),color:n.color})}),n.types=a,idToPokemon[e]=n}),$selectExclude.select2({placeholder:i8ln("Select PokÃ©mon"),data:t,templateResult:e}),$selectPokemonNotify.select2({placeholder:i8ln("Select PokÃ©mon"),data:t,templateResult:e}),$selectRarityNotify.select2({placeholder:i8ln("Select Rarity"),data:[i8ln("Common"),i8ln("Uncommon"),i8ln("Rare"),i8ln("Very Rare"),i8ln("Ultra Rare")],templateResult:e}),$selectExclude.on("change",function(e){buffer=excludedPokemon,excludedPokemon=$selectExclude.val().map(Number),buffer=buffer.filter(function(e){return this.indexOf(e)<0},excludedPokemon),reincludedPokemon=reincludedPokemon.concat(buffer),clearStaleMarkers(),Store.set("remember_select_exclude",excludedPokemon)}),$selectPokemonNotify.on("change",function(e){notifiedPokemon=$selectPokemonNotify.val().map(Number),Store.set("remember_select_notify",notifiedPokemon)}),$selectRarityNotify.on("change",function(e){notifiedRarity=$selectRarityNotify.val().map(String),Store.set("remember_select_rarity_notify",notifiedRarity)}),$textPerfectionNotify.on("change",function(e){notifiedMinPerfection=parseInt($textPerfectionNotify.val(),10),(isNaN(notifiedMinPerfection)||notifiedMinPerfection<=0)&&(notifiedMinPerfection=""),notifiedMinPerfection>100&&(notifiedMinPerfection=100),$textPerfectionNotify.val(notifiedMinPerfection),Store.set("remember_text_perfection_notify",notifiedMinPerfection)}),$selectExclude.val(Store.get("remember_select_exclude")).trigger("change"),$selectPokemonNotify.val(Store.get("remember_select_notify")).trigger("change"),$selectRarityNotify.val(Store.get("remember_select_rarity_notify")).trigger("change"),$textPerfectionNotify.val(Store.get("remember_text_perfection_notify")).trigger("change"),isTouchDevice()&&isMobileDevice()&&$(".select2-search input").prop("readonly",!0)}),window.setInterval(updateLabelDiffTime,1e3),window.setInterval(updateMap,5e3),window.setInterval(updateGeoLocation,1e3),createUpdateWorker(),$("#gyms-switch").change(function(){var e={duration:500},t=$("#gym-sidebar-wrapper");this.checked?(lastgyms=!1,t.show(e)):(lastgyms=!1,t.hide(e));var a=$("#gyms-filter-wrapper");this.checked?(lastgyms=!1,a.show(e)):(lastgyms=!1,a.hide(e)),n(mapData,["gyms"],"showGyms").bind(this)()}),$("#pokemon-switch").change(function(){n(mapData,["pokemons"],"showPokemon").bind(this)()}),$("#scanned-switch").change(function(){n(mapData,["scanned"],"showScanned").bind(this)()}),$("#spawnpoints-switch").change(function(){n(mapData,["spawnpoints"],"showSpawnpoints").bind(this)()}),$("#ranges-switch").change(n(mapData,["gyms","pokemons","pokestops"],"showRanges")),$("#pokestops-switch").change(function(){var e={duration:500},t=$("#lured-pokestops-only-wrapper");return this.checked?(lastpokestops=!1,t.show(e)):(lastpokestops=!1,t.hide(e)),n(mapData,["pokestops"],"showPokestops").bind(this)()}),$("#sound-switch").change(function(){Store.set("playSound",this.checked);var e={duration:500},n=$("#pokemoncries");this.checked?n.show(e):n.hide(e)}),$("#cries-switch").change(function(){Store.set("playCries",this.checked)}),$("#geoloc-switch").change(function(){$("#next-location").prop("disabled",this.checked),$("#next-location").css("background-color",this.checked?"#e0e0e0":"#ffffff"),navigator.geolocation?Store.set("geoLocate",this.checked):this.checked=!1}),$("#lock-marker-switch").change(function(){Store.set("lockMarker",this.checked),searchMarker.setDraggable(!this.checked)}),$("#search-switch").change(function(){searchControl(this.checked?"on":"off")}),$("#start-at-user-location-switch").change(function(){Store.set("startAtUserLocation",this.checked)}),$("#follow-my-location-switch").change(function(){navigator.geolocation?Store.set("followMyLocation",this.checked):this.checked=!1,locationMarker.setDraggable(!this.checked)}),$("#scan-here-switch").change(function(){this.checked&&!Store.get("scanHereAlerted")&&(alert("Use this feature carefully ! This button will set the current map center as new search location. This may cause worker to teleport long range."),Store.set("scanHereAlerted",!0)),$("#scan-here").toggle(this.checked),Store.set("scanHere",this.checked)}),$("#nav-accordion").length&&$("#nav-accordion").accordion({active:0,collapsible:!0,heightStyle:"content"}),$("#pokemonList_table").DataTable({paging:!1,searching:!1,info:!1,errMode:"throw",language:{emptyTable:""},columns:[{orderable:!1},null,null,null]}).order([1,"asc"])});
//# sourceMappingURL=map.min.js.map